<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{% block title %}El Rincón del Soldado{% endblock %}</title>

  <!-- Google Fonts: Poppins -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.5/font/bootstrap-icons.css" rel="stylesheet" />
  <!-- Animate.css -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <!-- Estilo personalizado -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />

  {% block extra_head %}{% endblock %}
</head>

<body class="home" style="font-family: 'Poppins', sans-serif;">
  <!-- NAVBAR -->
  <nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center" href="{{ url_for('index') }}">
        <i class="fas fa-mug-hot me-2"></i> El Rincón del Soldado
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link inicio-special" href="{{ url_for('index') }}">
              <span class="inicio-highlight">Inicio</span>
            </a>
          </li>

          {% if session.get('usuario_id') %}
            <li class="nav-item"><a class="nav-link" href="{{ url_for('menu') }}">Carta</a></li>
            <li class="nav-item"><a class="nav-link" href="{{ url_for('disena_menu') }}">Diseña tu Menú</a></li>
            <li class="nav-item"><a class="nav-link" href="{{ url_for('reservas') }}">Reservas</a></li>
            <li class="nav-item"><a class="nav-link" href="{{ url_for('contacto') }}">Contacto</a></li>

            {% if session.get('rol') == 'admin' %}
              <li class="nav-item"><a class="nav-link" href="{{ url_for('admin_index') }}">Admin</a></li>
            {% endif %}

            <!-- DROPDOWN USUARIO CON MINI AVATAR -->
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle d-flex align-items-center gap-2" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                {% if session.get('avatar') %}
                  <img src="{{ url_for('static', filename=session['avatar']) }}"
                       alt="avatar"
                       style="width:24px;height:24px;border-radius:50%;object-fit:cover;border:1px solid #d4af37;">
                {% else %}
                  <img src="{{ url_for('static', filename='img/avatars/default.webp') }}"
                       alt="avatar"
                       style="width:24px;height:24px;border-radius:50%;object-fit:cover;border:1px solid #d4af37;">
                {% endif %}
                <span>{{ session.get('nombre') }}</span>
              </a>
              <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
                <li><a class="dropdown-item" href="{{ url_for('perfil') }}">Perfil</a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="{{ url_for('logout') }}"><i class="bi bi-box-arrow-right"></i> Cerrar sesión</a></li>
              </ul>
            </li>

           {# Carrito en navbar #}
<li class="nav-item">
  <a class="nav-link position-relative" href="{{ url_for('checkout') }}" title="Carrito">
    <!-- Icono carrito (SVG, sin librerías externas) -->
    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22"
         fill="none" viewBox="0 0 24 24" stroke="currentColor"
         stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
         class="me-1 text-gold">
      <circle cx="9" cy="21" r="1"></circle>
      <circle cx="20" cy="21" r="1"></circle>
      <path d="M1 1h4l2.68 12.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61l1.38-7.39H6"></path>
    </svg>

    {# contador del carrito #}
    {% set cart_count = (session.get('carrito')|length) if session.get('carrito') else 0 %}
    <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-primary"
          style="font-size:.65rem;">
      {{ cart_count }}
    </span>
  </a>
</li>
 

          {% else %}
            <li class="nav-item pe-1"><a class="nav-link" href="{{ url_for('login') }}">Acceder</a></li>
            <li class="nav-item pe-1"><a class="nav-link" href="{{ url_for('registro') }}">Registro</a></li>
          {% endif %}
        </ul>
      </div>
    </div>
  </nav>

  <!-- CONTENIDO PRINCIPAL -->
  <main class="container my-4">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }} alert-dismissible fade show animate__animated animate__fadeInDown" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}
    {% block content %}{% endblock %}
  </main>

<!-- FOOTER PROFESIONAL -->
<footer class="footer-profesional mt-auto bg-dark text-light">
  <div class="container">
    <div class="row text-center text-md-center align-items-center">
      <!-- Columna izquierda -->
      <div class="col-md-6 mb-3">
        <h5 class="fw-bold">El Rincón del Soldado</h5>
        <p style="max-width: 400px; margin: 0 auto;">
          Una Mesón con alma militar. Donde tradición, sabor y compañerismo se unen en un solo lugar.
        </p>
      </div>
      <!-- Columna derecha -->
      <div class="col-md-6 mb-3">
        <h5 class="fw-bold">Información</h5>
        <ul class="list-unstyled mb-0">
          <li><a href="{{ url_for('quienes_somos') }}" class="text-decoration-none text-light">Quiénes Somos</a></li>
          <li><a href="{{ url_for('aviso_legal') }}" class="text-decoration-none text-light">Aviso Legal</a></li>
          <li><a href="{{ url_for('politica_privacidad') }}" class="text-decoration-none text-light">Política de Privacidad</a></li>
          <li><a href="{{ url_for('politica_cookies') }}" class="text-decoration-none text-light">Política de Cookies</a></li>
        </ul>
      </div>
    </div>
    <hr class="my-3 text-secondary" />
    <div class="text-center small text-secondary">
      © 2025 El Rincón del Soldado · Todos los derechos reservados
    </div>
  </div>
</footer>


  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
